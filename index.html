 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Progression Workouts</title>
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#121212">
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
/* Reset & Base */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #121212; color: #fff; height: 100vh; }

/* Screens */
.screen { display: none; padding: 20px; max-width: 500px; margin: auto; }
.active-screen { display: block; }

/* Home Dashboard */
.dashboard { text-align: center; margin-top: 60px; }
.logo { font-size: 48px; font-weight: bold; color: #ff3b30; margin-bottom: 10px; }
.tagline { color: #8e8e93; font-size: 16px; text-transform: uppercase; margin-bottom: 40px; }
.btn { display: block; width: 100%; padding: 18px; margin: 10px 0; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; border: none; transition: all 0.3s; }
.btn-primary { background: linear-gradient(135deg,#ff3b30,#ff6347); color: #fff; }
.btn-primary:hover { opacity: 0.9; }
.btn-secondary { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
.stats-hint { margin-top: 30px; padding: 16px; background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }

/* Plan Screen */
.plan-container { display: grid; gap: 16px; }
.day-card { background: #1E1E1E; border-radius: 12px; padding: 16px; }
.day-card h3 { color: #FF6600; margin-bottom: 8px; }

/* Logging Screen */
.exercise-entry { background: #1E1E1E; padding: 14px; border-radius: 8px; margin-bottom: 12px; }
.exercise-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 16px; }
.controls { display: flex; justify-content: space-around; }
.control-group { text-align: center; }
.control-btn { width: 32px; height: 32px; border-radius: 50%; background: #FF6600; color: #fff; border: none; font-size: 18px; cursor: pointer; }
.value-display { font-size: 18px; margin-top: 6px; }

/* Bottom Nav */
.bottom-nav { position: fixed; bottom: 0; width: 100%; background: #1E1E1E; display: flex; justify-content: space-around; padding: 10px 0; }
.nav-item { color: #aaa; text-align: center; font-size: 12px; cursor: pointer; }
.nav-item.active { color: #FF6600; }
</style>
</head>
<body>

<!-- Screen 1: Home -->
<div id="home-screen" class="screen active-screen">
  <div class="dashboard">
    <div class="logo">Progression</div>
    <div class="tagline">Smart Training</div>
    <button class="btn btn-primary" onclick="navigate('logging-screen')">üèãÔ∏è Start Next Workout</button>
    <button class="btn btn-secondary" onclick="navigate('plan-screen')">‚ú® View Plan</button>
    <div class="stats-hint">
      <div class="stats-title">Ready to train</div>
      <div class="stats-value" id="lastWorkoutText">Loading...</div>
    </div>
  </div>
</div>

<!-- Screen 2: Plan -->
<div id="plan-screen" class="screen">
  <h2>Your Plan</h2>
  <div class="plan-container" id="workoutPlan"></div>
</div>

<!-- Screen 3: Logging -->
<div id="logging-screen" class="screen">
  <h2>Today's Workout</h2>
  <div id="loggingForm"></div>
  <button class="btn btn-primary" onclick="saveWorkout()">Save Workout</button>
  <p id="logStatus"></p>
</div>

<!-- Screen 4: History -->
<div id="history-screen" class="screen">
  <h2>Workout History</h2>
  <p>Coming soon: Progress charts and past sessions.</p>
</div>

<!-- Screen 5: Settings -->
<div id="settings-screen" class="screen">
  <h2>Settings</h2>
  <p>Connect your account:</p>
  <div id="signin-btn" class="g_id_signin"
    data-type="standard"
    data-size="large"
    data-theme="outline"
    data-client_id="YOUR_GOOGLE_CLIENT_ID"
    data-callback="handleCredentialResponse">
  </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <div class="nav-item active" onclick="navigate('home-screen')">üè†<br>Home</div>
  <div class="nav-item" onclick="navigate('plan-screen')">üìã<br>Plan</div>
  <div class="nav-item" onclick="navigate('logging-screen')">üìù<br>Log</div>
  <div class="nav-item" onclick="navigate('history-screen')">üìÖ<br>History</div>
  <div class="nav-item" onclick="navigate('settings-screen')">‚öôÔ∏è<br>Settings</div>
</div>

<script>
// ‚úÖ Register Service Worker for PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js')
    .then(() => console.log('‚úÖ Service Worker Registered'))
    .catch(err => console.error('‚ùå Service Worker Error:', err));
}

/* State & IndexedDB Setup */
let userPreferences = JSON.parse(localStorage.getItem('preferences')) || { goal: 'Hypertrophy', equipment: 'Gym', days: 3 };
let currentWeek = 1;
let db;
const request = indexedDB.open('WorkoutDB', 1);
request.onupgradeneeded = e => {
  db = e.target.result;
  db.createObjectStore('workouts', { keyPath: 'id', autoIncrement: true });
};
request.onsuccess = e => { db = e.target.result; loadLastWorkout(); };

/* Navigation */
function navigate(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
  document.getElementById(screenId).classList.add('active-screen');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(nav => {
    if (nav.textContent.includes(screenId.split('-')[0])) nav.classList.add('active');
  });
}

/* Generate Plan */
function generateWorkoutPlan() {
  const container = document.getElementById('workoutPlan');
  container.innerHTML = '';
  const templates = getWorkoutTemplate(userPreferences.days);
  templates.forEach((dayPlan, i) => {
    let div = document.createElement('div');
    div.className = 'day-card';
    div.innerHTML = `<h3>Day ${i+1}: ${dayPlan.day}</h3>`;
    dayPlan.exercises.forEach(ex => {
      let suggestedWeight = Math.round(ex.weight * (1 + 0.025 * (currentWeek-1)));
      div.innerHTML += `<p>${ex.name} ‚Äî ${ex.sets} sets (${suggestedWeight} lbs)</p>`;
    });
    container.appendChild(div);
  });
}

/* Template */
function getWorkoutTemplate(days) {
  return [
    { day: "Push", exercises: [{name:"Bench Press", sets:4, weight:135},{name:"Overhead Press", sets:3, weight:95}] },
    { day: "Pull", exercises: [{name:"Deadlift", sets:3, weight:225},{name:"Pull-Ups", sets:4, weight:0}] }
  ];
}

/* Logging Screen */
function loadLoggingUI() {
  const form = document.getElementById('loggingForm');
  form.innerHTML = '';
  const exercises = getWorkoutTemplate(2)[0].exercises; // Example: Day 1
  exercises.forEach(ex => {
    const div = document.createElement('div');
    div.className = 'exercise-entry';
    div.innerHTML = `
      <div class="exercise-header"><strong>${ex.name}</strong></div>
      <div class="controls">
        <div class="control-group">
          <button class="control-btn" onclick="adjustValue(this,-1)">-</button>
          <div class="value-display" data-type="reps">10</div>
          <button class="control-btn" onclick="adjustValue(this,1)">+</button>
          <div>Reps</div>
        </div>
        <div class="control-group">
          <button class="control-btn" onclick="adjustValue(this,-5)">-</button>
          <div class="value-display" data-type="weight">${ex.weight}</div>
          <button class="control-btn" onclick="adjustValue(this,5)">+</button>
          <div>Weight</div>
        </div>
      </div>`;
    form.appendChild(div);
  });
}

function adjustValue(el, change) {
  const display = el.parentElement.querySelector('.value-display');
  let val = parseInt(display.textContent);
  val = Math.max(0, val + change);
  display.textContent = val;
}

function saveWorkout() {
  const exercises = [];
  document.querySelectorAll('.exercise-entry').forEach(entry => {
    const name = entry.querySelector('.exercise-header strong').textContent;
    const reps = entry.querySelector('[data-type="reps"]').textContent;
    const weight = entry.querySelector('[data-type="weight"]').textContent;
    exercises.push({ name, reps, weight });
  });
  const workout = { date: new Date().toISOString(), exercises };
  const tx = db.transaction('workouts','readwrite');
  tx.objectStore('workouts').add(workout);
  document.getElementById('logStatus').textContent = "‚úÖ Saved locally!";
  loadLastWorkout();
}

/* Last Workout Stats */
function loadLastWorkout() {
  const tx = db.transaction('workouts','readonly');
  tx.objectStore('workouts').getAll().onsuccess = e => {
    const workouts = e.target.result;
    if (workouts.length > 0) {
      const lastDate = new Date(workouts[workouts.length-1].date);
      const daysAgo = Math.floor((Date.now()-lastDate.getTime())/(1000*60*60*24));
      document.getElementById('lastWorkoutText').textContent = `Your last workout was ${daysAgo} day(s) ago`;
    } else {
      document.getElementById('lastWorkoutText').textContent = "No workouts logged yet.";
    }
  };
}

/* Google Sign-In Callback */
function handleCredentialResponse(response) {
  console.log("Google Sign-In Token:", response.credential);
  // TODO: Send token to Apps Script for sync
}

/* Init */
window.onload = () => {
  generateWorkoutPlan();
  loadLoggingUI();
  loadLastWorkout(); // ‚úÖ Added to show last workout stats
};
</script>
</body>
</html>
